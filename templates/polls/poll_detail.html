{% extends 'base.html' %}
{% load component_tags %}

{% block title %}{{ poll.title }} - Votely{% endblock %}

{% block content %}
<div class="row" data-poll-id="{{ poll.pk }}">
    <div class="col-lg-8">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'polls:list' %}">Polls</a></li>
                <li class="breadcrumb-item active">{{ poll.title|truncatechars:50 }}</li>
            </ol>
        </nav>
        
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">{{ poll.title }}</h1>
                <p class="card-text">{{ poll.description|linebreaks }}</p>
                
                {% if poll.tags.all %}
                <div class="tag-list mb-3">
                    {% for tag in poll.tags.all %}
                        <a href="{% url 'polls:list' %}?tags={{ tag.name }}" class="badge bg-secondary text-decoration-none">
                            {{ tag.name }}
                        </a>
                    {% endfor %}
                </div>
                {% endif %}
                
                <div class="d-flex justify-content-between align-items-center text-muted">
                    <small>
                        <i class="bi bi-person"></i> Created by {{ poll.created_by.username }}
                    </small>
                    <small>
                        <i class="bi bi-calendar"></i> {{ poll.created_at|date:"F d, Y \a\\t g:i A" }}
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        {% if user.is_authenticated %}
            {% component "vote_form" form=vote_form poll=poll user_vote=user_vote / %}
        {% else %}
            <div class="card">
                <div class="card-body text-center">
                    <i class="bi bi-lock display-4 text-muted"></i>
                    <h5 class="mt-3">Login Required</h5>
                    <p class="text-muted">You need to login to vote on this poll.</p>
                    <a href="{% url 'account_login' %}?next={{ request.get_full_path }}" class="btn btn-primary">
                        <i class="bi bi-box-arrow-in-right"></i> Login
                    </a>
                    <a href="{% url 'account_signup' %}" class="btn btn-outline-primary">
                        <i class="bi bi-person-plus"></i> Sign Up
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div id="poll-results">
            {% component "poll_results" poll=poll results=results / %}
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-share"></i> Share This Poll</h5>
            </div>
            <div class="card-body">
                <div class="input-group">
                    <input type="text" class="form-control" 
                           value="{{ request.build_absolute_uri }}" 
                           id="share-url" readonly>
                    <button class="btn btn-outline-secondary" 
                            onclick="copyToClipboard()" 
                            id="copy-btn">
                        <i class="bi bi-clipboard"></i> Copy
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyToClipboard() {
    const urlInput = document.getElementById('share-url');
    const copyBtn = document.getElementById('copy-btn');
    
    urlInput.select();
    urlInput.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(urlInput.value);
    
    const originalText = copyBtn.innerHTML;
    copyBtn.innerHTML = '<i class="bi bi-check"></i> Copied!';
    copyBtn.classList.remove('btn-outline-secondary');
    copyBtn.classList.add('btn-success');
    
    setTimeout(() => {
        copyBtn.innerHTML = originalText;
        copyBtn.classList.remove('btn-success');
        copyBtn.classList.add('btn-outline-secondary');
    }, 2000);
}
</script>
{% endblock %}
